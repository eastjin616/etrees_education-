<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="board">
    
    <resultMap type="com.spring.board.vo.BoardVo" id="boardVo">
    	<result property="boardType" 	column="BOARD_TYPE"/>
    	<result property="boardNum" 	column="BOARD_NUM"/>
    	<result property="boardTitle" 	column="BOARD_TITLE"/>
    	<result property="boardComment" column="BOARD_COMMENT"/>
    	
    	
    	<result property="boardTypeName" column="BOARD_TYPE_NAME"/>
    </resultMap>
    
<select id="boardList" parameterType="com.spring.board.vo.PageVo" resultMap="boardVo">
    SELECT 
        b.BOARD_TYPE,
        b.BOARD_NUM,
        b.BOARD_TITLE,
        b.BOARD_COMMENT,
        c.CODE_NAME AS BOARD_TYPE_NAME, 
        TOTAL_CNT
    FROM (
        SELECT
            BOARD_TYPE,
            BOARD_NUM,
            BOARD_TITLE,
            BOARD_COMMENT,
            ROW_NUMBER() OVER (ORDER BY BOARD_NUM DESC) AS NUMROW,
            COUNT(*) OVER() AS TOTAL_CNT
        FROM BOARD
    ) b
    LEFT JOIN COM_CODE c ON b.BOARD_TYPE = c.CODE_ID
    WHERE c.CODE_TYPE = 'menu'
      AND NUMROW BETWEEN (#{pageNo} - 1) * 10 + 1 AND (#{pageNo}) * 10
</select>

    
    <select id="boardTotal" parameterType="Integer" resultType="Integer">
		  SELECT
		      	COUNT(*) AS TOTAL_CNT
			FROM
				BOARD	
    </select>
    	
    <select id="boardView" parameterType="com.spring.board.vo.BoardVo" resultMap="boardVo">
    	SELECT
        	BOARD_TYPE
			,BOARD_NUM
			,BOARD_TITLE
			,BOARD_COMMENT
		FROM
			BOARD
    	WHERE 	BOARD_TYPE = #{boardType}
    	AND 	BOARD_NUM  = #{boardNum}
    </select>	
    
<insert id="boardInsert" parameterType="com.spring.board.vo.BoardVo">

    <!-- 1. INSERT 전에 boardNum을 미리 계산해서 boardVo.setBoardNum()에 담김 GPT돌림 자꾸 에러뜨길래... -->
    <selectKey keyProperty="boardNum" resultType="int" order="BEFORE">
        SELECT NVL(MAX(BOARD_NUM), 0) + 1 
        FROM BOARD
        WHERE BOARD_TYPE = #{boardType}
    </selectKey>

    INSERT INTO BOARD (
        BOARD_TYPE,
        BOARD_NUM,
        BOARD_TITLE,
        BOARD_COMMENT,
        CREATOR,
        CREATE_TIME,
        MODIFIER,
        MODIFIED_TIME
    ) VALUES (
        #{boardType},
        #{boardNum},
        #{boardTitle},
        #{boardComment},
        'SYSTEM',
        TO_CHAR(SYSDATE),
        'SYSTEM',
        TO_CHAR(SYSDATE)
    )
</insert>

    
     <update id="boardUpdate" parameterType="com.spring.board.vo.BoardVo">    
		UPDATE BOARD
		SET BOARD_TITLE = #{boardTitle},
		    BOARD_COMMENT = #{boardComment}
		WHERE BOARD_TYPE = #{boardType}
		  AND BOARD_NUM = #{boardNum}
	</update>
	
	<delete id="boardDelete">
		DELETE FROM BOARD WHERE BOARD_NUM = #{boardNum}
	</delete>
	
	<select id="selectMbtiList" parameterType="com.spring.board.vo.BoardVo" resultType="com.spring.board.vo.BoardVo">
	    SELECT board_num AS boardNum
		     , board_type AS boardType
		     , board_comment AS boardComment
		  FROM board
		 WHERE board_type in('EI','IE','NS','SN','FT','TF','JP','PJ')
		   AND board_num BETWEEN #{startRow} AND #{endRow}
		 ORDER BY board_num
	</select>
	
	<select id="checkBoxResult" parameterType="com.spring.board.vo.BoardVo" resultType="com.spring.board.vo.BoardVo">
		SELECT
			BOARD_TYPE AS boardType,
			BOARD_NUM AS boardNum,
			BOARD_TITLE AS boardTitle,
			BOARD_COMMENT AS boardComment,
			CODE_NAME AS boardTypeName        
		FROM BOARD 
		JOIN COM_CODE ON (BOARD_TYPE = CODE_ID) 
		WHERE BOARD_TYPE IN
		<foreach item="type" collection="list" open="(" separator="," close=")">
			#{type}
		</foreach>
		ORDER BY 2 DESC

	</select>

</mapper>
